å›¢é˜Ÿè®°è´¦å·¥å…·é¡¹ç›®ä»£ç 

ä¸‹é¢æ˜¯åŸºäº Flask çš„å›¢é˜Ÿè®°è´¦ Web åº”ç”¨å®Œæ•´é¡¹ç›®ä»£ç ï¼ŒåŒ…æ‹¬é¡¹ç›®ç»“æ„ã€ä¸»è¦ä»£ç æ–‡ä»¶ã€æ¨¡æ¿ï¼Œä»¥åŠä¾èµ–å®‰è£…å’Œè¿è¡Œè¯´æ˜ã€‚

é¡¹ç›®ç»“æ„

team_accounting/               # é¡¹ç›®æ ¹ç›®å½•
â”œâ”€â”€ app.py                     # Flask åº”ç”¨å…¥å£
â”œâ”€â”€ config.py                  # é…ç½®æ–‡ä»¶ï¼ˆå¦‚ SECRET_KEYã€æ•°æ®åº“URIï¼‰
â”œâ”€â”€ models.py                  # æ•°æ®æ¨¡å‹å®šä¹‰ï¼ˆUser, Tag, Expenseï¼‰
â”œâ”€â”€ requirements.txt           # é¡¹ç›®ä¾èµ–åˆ—è¡¨
â”œâ”€â”€ auth/                      # èº«ä»½è®¤è¯åŠŸèƒ½æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py            # å®šä¹‰ auth Blueprint
â”‚   â””â”€â”€ routes.py              # æ³¨å†Œã€ç™»å½•ã€ç™»å‡ºè·¯ç”±
â”œâ”€â”€ main/                      # æ™®é€šç”¨æˆ·åŠŸèƒ½æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py            # å®šä¹‰ main Blueprint
â”‚   â””â”€â”€ routes.py              # æäº¤ç”³è¯·ã€æŸ¥çœ‹è‡ªèº«ç”³è¯·è·¯ç”±
â”œâ”€â”€ admin/                     # ç®¡ç†å‘˜åŠŸèƒ½æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py            # å®šä¹‰ admin Blueprint
â”‚   â””â”€â”€ routes.py              # å®¡æ ¸ã€åˆ†ç±»ç®¡ç†ã€ç»Ÿè®¡å¯¼å‡ºè·¯ç”±
â”œâ”€â”€ templates/                 # å‰ç«¯æ¨¡æ¿
â”‚   â”œâ”€â”€ base.html              # åŸºç¡€é¡µé¢æ¡†æ¶æ¨¡æ¿
â”‚   â”œâ”€â”€ auth/                  # auth æ¨¡å—ç›¸å…³æ¨¡æ¿
â”‚   â”‚   â”œâ”€â”€ login.html         # ç™»å½•é¡µé¢
â”‚   â”‚   â””â”€â”€ register.html      # æ³¨å†Œé¡µé¢
â”‚   â”œâ”€â”€ main/                  # main æ¨¡å—ç›¸å…³æ¨¡æ¿
â”‚   â”‚   â”œâ”€â”€ submit.html        # æäº¤æŠ¥é”€ç”³è¯·é¡µé¢
â”‚   â”‚   â””â”€â”€ my_requests.html   # â€œæˆ‘çš„ç”³è¯·â€é¡µé¢
â”‚   â””â”€â”€ admin/                 # admin æ¨¡å—ç›¸å…³æ¨¡æ¿
â”‚       â”œâ”€â”€ pending.html       # å¾…å®¡æ ¸åˆ—è¡¨é¡µé¢
â”‚       â”œâ”€â”€ tags.html          # åˆ†ç±»åŠé¢„ç®—ç®¡ç†é¡µé¢
â”‚       â””â”€â”€ stats.html         # è´¢åŠ¡ç»Ÿè®¡é¡µé¢
â””â”€â”€ static/                    # é™æ€æ–‡ä»¶ç›®å½•ï¼ˆä¿å­˜å›¾è¡¨ç­‰ï¼‰
    â””â”€â”€ ...                    # ä¾‹å¦‚ç”Ÿæˆçš„ç»Ÿè®¡å›¾è¡¨ stats.png


ä¾èµ–å®‰è£…ä¸è¿è¡Œè¯´æ˜

1. å®‰è£…ä¾èµ–ï¼š ç¡®ä¿å·²å®‰è£… Python 3ï¼Œä½¿ç”¨ pip å®‰è£…æ‰€éœ€ä¾èµ–åº“ï¼š

åˆ›å»º requirements.txt æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š

Flask
Flask-SQLAlchemy
Flask-Login
pandas
matplotlib
openpyxl

ç„¶åè¿è¡Œå®‰è£…ï¼š

pip install -r requirements.txt

2. åˆå§‹åŒ–æ•°æ®åº“ï¼š æ— éœ€æ‰‹åŠ¨å»ºåº“ï¼Œé¦–æ¬¡è¿è¡Œåº”ç”¨æ—¶ä¼šè‡ªåŠ¨åˆ›å»º SQLite æ•°æ®åº“æ–‡ä»¶ team_accounting.db å¹¶å»ºè¡¨ã€‚

3. è¿è¡Œåº”ç”¨ï¼š åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹è¿è¡Œï¼š

python3 app.py

åº”ç”¨å°†å¯åŠ¨åœ¨é»˜è®¤çš„ http://127.0.0.1:5000ã€‚

4. åˆå§‹è®¾ç½®ï¼š ç”¨æµè§ˆå™¨è®¿é—®åº”ç”¨ï¼Œé¦–æ¬¡ä½¿ç”¨è¯·å…ˆæ³¨å†Œè´¦æˆ·ã€‚ç¬¬ä¸€ä¸ªæ³¨å†Œçš„ç”¨æˆ·å°†è‡ªåŠ¨è·å¾—ç®¡ç†å‘˜æƒé™ï¼ˆç”¨äºå®¡æ‰¹æŠ¥é”€å’Œç®¡ç†é¢„ç®—åˆ†ç±»ï¼‰ã€‚ç®¡ç†å‘˜ç™»å½•åï¼Œå¯è¿›å…¥â€œManage Tagsâ€é¡µé¢æ·»åŠ æŠ¥é”€åˆ†ç±»åŠé¢„ç®—é¢åº¦ã€‚

5. æäº¤å’Œå®¡æ ¸æµç¨‹ï¼š æ™®é€šå›¢é˜Ÿæˆå‘˜ç™»å½•åï¼Œå¯åœ¨â€œSubmit Expenseâ€é¡µé¢æäº¤æŠ¥é”€ç”³è¯·ï¼ˆå¡«å†™é‡‘é¢ã€ç”¨é€”ã€æ—¥æœŸå¹¶é€‰æ‹©åˆ†ç±»ï¼‰ã€‚æäº¤åç”³è¯·çŠ¶æ€ä¸ºå¾…å®¡æ ¸ï¼Œç®¡ç†å‘˜ç™»å½•åå¯åœ¨â€œPending Requestsâ€é¡µé¢æŸ¥çœ‹æ‰€æœ‰å¾…å®¡æ ¸ç”³è¯·ï¼Œæ‰§è¡Œæ‰¹å‡†æˆ–æ‹’ç»æ“ä½œã€‚
	â€¢	å½“ç®¡ç†å‘˜ç‚¹å‡»æ‰¹å‡†æ—¶ï¼Œç³»ç»Ÿä¼šæ ¡éªŒè¯¥ç”³è¯·æ‰€å±åˆ†ç±»çš„å·²ç”¨é‡‘é¢æ˜¯å¦æœªè¶…å‡ºé¢„ç®—ï¼›è‹¥è¶…è¿‡é¢„ç®—åˆ™æ— æ³•æ‰¹å‡†ã€ç³»ç»Ÿå°†æç¤ºè¶…é¢ã€‘ã€‚
	â€¢	æ‰¹å‡†åçš„ç”³è¯·çŠ¶æ€å˜ä¸ºå·²æ‰¹å‡†ï¼Œå†™å…¥æ­£å¼è´¦æœ¬ï¼ˆå³æ•°æ®åº“ä¸­çŠ¶æ€æ ‡è®°ä¸º approvedï¼‰ï¼›æ‹’ç»çš„ç”³è¯·çŠ¶æ€æ ‡è®°ä¸º rejectedï¼ˆæˆå‘˜å¯æ ¹æ®éœ€è¦é‡æ–°æäº¤ç”³è¯·ï¼‰ã€‚

6. è´¢åŠ¡ç»Ÿè®¡ä¸å¯¼å‡ºï¼š ç®¡ç†å‘˜å¯åœ¨â€œStatisticsâ€é¡µé¢æŸ¥çœ‹æ•´ä½“è´¢åŠ¡ç»Ÿè®¡ï¼š
	â€¢	ç³»ç»Ÿä½¿ç”¨ Pandas æ±‡æ€»å„åˆ†ç±»çš„æ”¯å‡ºå¹¶ä½¿ç”¨ Matplotlib ç”ŸæˆæŸ±çŠ¶å›¾ï¼Œå±•ç¤ºæ¯ä¸ªåˆ†ç±»çš„å·²ç”¨é‡‘é¢ä¸é¢„ç®—å¯¹æ¯”ã€‚
	â€¢	ç‚¹å‡»é¡µé¢ä¸Šçš„â€œDownload CSVâ€æˆ–â€œDownload Excelâ€æŒ‰é’®ï¼Œå¯å¯¼å‡ºæ‰€æœ‰å·²æ‰¹å‡†æŠ¥é”€è®°å½•çš„æ˜ç»†è¡¨ï¼ˆåˆ†åˆ«ä¸º CSV æˆ– Excel æ–‡ä»¶ï¼‰ã€‚

ä»¥ä¸Šå³ä¸ºå®Œæ•´å¯è¿è¡Œé¡¹ç›®çš„ä»£ç ç»“æ„å’ŒåŠŸèƒ½è¯´æ˜ã€‚å°†ä¸Šè¿°æ–‡ä»¶ç»„ç»‡å¥½ç›®å½•ç»“æ„åï¼ŒæŒ‰ç…§è¯´æ˜å®‰è£…ä¾èµ–å¹¶è¿è¡Œåº”ç”¨ï¼Œå³å¯å¯åŠ¨å›¢é˜Ÿè®°è´¦ç½‘ç«™ã€‚ç¥ä½¿ç”¨æ„‰å¿«ï¼


å¦‚æœä½ éœ€è¦å¤–ç½‘è®¿é—®ï¼Œéœ€è¦ä¿®æ”¹ Flask å¯åŠ¨æ–¹å¼ï¼šç»‘å®šå…¬ç½‘ IP

é»˜è®¤ Flask åªç›‘å¬ 127.0.0.1ï¼Œåªèƒ½æœ¬æœºè®¿é—®ã€‚ä½ è¦è®©å…¶ä»–è®¾å¤‡è®¿é—®ï¼Œéœ€è¦ç»‘å®š 0.0.0.0ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š

# å¼€å‘æ¨¡å¼å¯åŠ¨ + å¤–ç½‘å¯è®¿é—®
export FLASK_ENV=development
export FLASK_APP=app.py
flask run --host=0.0.0.0 --port=5000

æˆ–è€…ç›´æ¥ç”¨ Pythonï¼š

python3 app.py

è¿™éœ€è¦ä¿®æ”¹ä»£ç ï¼Œåœ¨ä½ çš„ app.py æ–‡ä»¶æœ«å°¾æ·»åŠ è¿™ä¸€è¡Œï¼š

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=5000, debug=True)


â¸»

ğŸ“¡ è¡¥å……è¯´æ˜ï¼š

âœ… å¤–ç½‘è®¿é—®éœ€è¦æ»¡è¶³ä¸¤ä¸ªå‰æï¼š
	1.	ä½ æœ¬åœ°çš„ IP æ˜¯å±€åŸŸç½‘ä¸­çš„å±€åŸŸåœ°å€ï¼ˆå¦‚ 192.168.x.xï¼‰
	â€¢	åœ¨åŒä¸€ WiFi ä¸‹ï¼Œæ‰‹æœºæˆ–åˆ«çš„è®¾å¤‡å¯ç›´æ¥è®¿é—®ä½ çš„ IPã€‚
	2.	é˜²ç«å¢™æ²¡æœ‰é˜»æŒ¡ 5000 ç«¯å£
	â€¢	macOS é»˜è®¤å…è®¸ localhost æœåŠ¡ï¼Œé€šå¸¸æ²¡é—®é¢˜ï¼›
	â€¢	Windows ç”¨æˆ·è¦æ£€æŸ¥é˜²ç«å¢™ï¼›
	â€¢	Linux ç”¨æˆ·å¯ä½¿ç”¨ ufw allow 5000/tcp å¼€æ”¾ç«¯å£ã€‚

â¸»

ğŸŒ æµ‹è¯•æ–¹æ³•ï¼š

âœ… æœ¬æœºæµ‹è¯•ï¼š

curl http://127.0.0.1:5000

âœ… å±€åŸŸç½‘å…¶ä»–è®¾å¤‡è®¿é—®ï¼š

åœ¨æµè§ˆå™¨è®¿é—®ä½ çš„ç”µè„‘ IPï¼Œä¾‹å¦‚ï¼š

http://192.168.1.10:5000

å¯ä»¥ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ IPï¼š

ifconfig  # mac æˆ– Linux
ipconfig  # Windows


â¸»

ğŸ”’ å¦‚æœä½ è¦éƒ¨ç½²åˆ°å…¬ç½‘æœåŠ¡å™¨ï¼š

æ¯”å¦‚æ”¾åˆ°é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ï¼Œå°±è¿˜éœ€è¦ï¼š
	â€¢	å¼€æ”¾äº‘æœåŠ¡å™¨é˜²ç«å¢™çš„ç«¯å£ï¼›
	â€¢	ä½¿ç”¨ gunicorn + nginx éƒ¨ç½²ï¼›
	â€¢	è®¾ç½®åŸŸåå’Œ SSL è¯ä¹¦ï¼ˆå¯é€‰ï¼‰ã€‚

â¸»

å¦‚æœä½ æƒ³è¦å¼€å‘ï¼Œå°†ä¸€ä¸ª Flask é¡¹ç›®ä¸Šä¼ åˆ° GitHub çš„å®Œæ•´æµç¨‹å¤§è‡´åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š


âœ… ç¬¬ä¸€æ­¥ï¼šè¿›å…¥é¡¹ç›®æ ¹ç›®å½•

cd /path/to/your/project/team_accounting

âœ… ç¬¬äºŒæ­¥ï¼šåˆå§‹åŒ– Git ä»“åº“

git init

âœ… ç¬¬ä¸‰æ­¥ï¼šåˆ›å»º .gitignore æ–‡ä»¶ï¼ˆå¾ˆé‡è¦ï¼‰

# .gitignore æ–‡ä»¶å†…å®¹å»ºè®®å¦‚ä¸‹ï¼š
__pycache__/
*.pyc
*.pyo
*.pyd
.env
myenv/
instance/
*.sqlite3
*.db
*.log
.DS_Store

ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ GitHub æä¾›çš„ Python æ¨¡æ¿ï¼š

curl -o .gitignore https://raw.githubusercontent.com/github/gitignore/main/Python.gitignore

âœ… ç¬¬å››æ­¥ï¼šæ·»åŠ è¿œç¨‹ GitHub ä»“åº“ï¼ˆå¦‚æœè¿˜æ²¡åˆ›å»ºï¼Œè¯·ç™»å½• github.com â†’ æ–°å»ºä¸€ä¸ªä»“åº“ï¼‰

git remote add origin https://github.com/ä½ çš„ç”¨æˆ·å/ä»“åº“å.git


âœ… ç¬¬äº”æ­¥ï¼šæäº¤ä»£ç 

git add .
git commit -m "Initial commit: Flask team accounting tool"

âœ… ç¬¬å…­æ­¥ï¼šæ¨é€åˆ° GitHubï¼ˆå¦‚æœæ˜¯æ–°ä»“åº“ï¼Œè¦åŠ ä¸Š -u origin mainï¼‰

git branch -M main  # ä¿è¯åˆ†æ”¯æ˜¯ mainï¼ˆGitHub é»˜è®¤ï¼‰
git push -u origin main

ğŸ“¦ ç¬¬ä¸ƒæ­¥ï¼šç”Ÿæˆ requirements.txt

è¿™ä¸€æ­¥æ˜¯åœ¨ä½ çš„è™šæ‹Ÿç¯å¢ƒä¸­æ‰§è¡Œçš„ï¼š

pip freeze > requirements.txt

ä¸Šä¼ è¿™ä¸ªæ–‡ä»¶ååˆ«äººå¯ä»¥ç”¨ä¸‹é¢å‘½ä»¤è¿˜åŸç¯å¢ƒï¼š

pip install -r requirements.txt


## å¿«é€Ÿå¼€å§‹

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/Benjaminisgood/Benony.git
cd /home/lqh

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv
source venv/bin/activate                                  # Windows ç”¨ venv\Scripts\activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# è¿è¡Œé¡¹ç›®
python app.py

export FLASK_APP=app.py
export FLASK_ENV=development
flask run

nohup python app.py > flask.log 2>&1 &

pip install gunicorn
gunicorn -w 3 -b 0.0.0.0:5000 app:app --daemon
pkill gunicorn

---

## ğŸ” å¯é€‰ï¼šæ·»åŠ  `.env` æ”¯æŒï¼ˆç¯å¢ƒå˜é‡ä¿æŠ¤ï¼‰

åœ¨ Flask é¡¹ç›®ä¸­ä½ å¯èƒ½ä¼šç”¨åˆ°æ•°æ®åº“ URI æˆ– SECRET_KEYï¼Œå¯ä»¥å†™åœ¨ `.env` æ–‡ä»¶ä¸­ï¼ˆå¹¶åœ¨ `.gitignore` ä¸­å¿½ç•¥ï¼‰ï¼š

```env
SECRET_KEY=your-secret-key
DATABASE_URL=sqlite:///team.db

ç„¶ååœ¨é¡¹ç›®ä¸­ç”¨ python-dotenv åŠ è½½ï¼š

from dotenv import load_dotenv
load_dotenv()


â¸»

âœ… å®Œæ•´æµç¨‹å¤ç›˜ï¼š

æ­¥éª¤	å‘½ä»¤
åˆå§‹åŒ– Git	git init
æ·»åŠ è¿œç¨‹ä»“åº“	git remote add origin ...
æ·»åŠ é¡¹ç›®æ–‡ä»¶	git add .
æäº¤	git commit -m "init"
æ¨é€åˆ° GitHub	git push -u origin main
å¯¼å‡ºä¾èµ–	pip freeze > requirements.txt
åˆ›å»º .gitignore	æ‰‹åŠ¨æˆ– curl
æ·»åŠ  README.md	è‡ªå·±å†™è¯´æ˜


â¸»



ä½¿ç”¨ systemd æ¥æ‰˜ç®¡ Flask é¡¹ç›®æ˜¯ä¸€ä¸ªä¸“ä¸šä¸”ç¨³å¥çš„éƒ¨ç½²æ–¹å¼ï¼Œæ”¯æŒï¼š
	â€¢	åå°è¿è¡Œ âœ…
	â€¢	è‡ªåŠ¨é‡å¯ âœ…
	â€¢	å¼€æœºè‡ªå¯ âœ…
	â€¢	æ—¥å¿—é›†ä¸­ç®¡ç† âœ…

å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š

âœ… æ­¥éª¤ä¸€ï¼šåˆ›å»º systemd æœåŠ¡æ–‡ä»¶

ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ–°å»ºæœåŠ¡é…ç½®æ–‡ä»¶ï¼š

sudo nano /etc/systemd/system/benony.service

ğŸ”§ ç„¶åå¤åˆ¶ç²˜è´´ä»¥ä¸‹å†…å®¹ï¼š

[Unit]
Description=Flask Team Accounting Service
After=network.target

[Service]
User=root
WorkingDirectory=/home/lqh
ExecStart=/home/lqh/venv/bin/python app.py
Restart=always
Environment=FLASK_ENV=production
Environment=FLASK_APP=app.py

[Install]
WantedBy=multi-user.target


â¸»

âœ… æ­¥éª¤äºŒï¼šé‡æ–°åŠ è½½ systemd å¹¶å¯åŠ¨æœåŠ¡

# é‡æ–°åŠ è½½ systemd é…ç½®
sudo systemctl daemon-reexec
sudo systemctl daemon-reload

# å¯åŠ¨æœåŠ¡
sudo systemctl start benony.service

# è®¾ç½®å¼€æœºè‡ªå¯
sudo systemctl enable benony.service


â¸»

âœ… æ­¥éª¤ä¸‰ï¼šæŸ¥çœ‹è¿è¡ŒçŠ¶æ€ä¸æ—¥å¿—

ğŸ” æŸ¥çœ‹æœåŠ¡çŠ¶æ€

sudo systemctl status benony.service

ğŸ“„ æŸ¥çœ‹æ—¥å¿—è¾“å‡º

journalctl -u benony.service -n 100 --no-pager

ä¹Ÿå¯ä»¥å®æ—¶ç›‘å¬ï¼š

journalctl -u benony.service -f


â¸»

ğŸ§¯ åœæ­¢ / é‡å¯æœåŠ¡

sudo systemctl stop benony.service
sudo systemctl restart benony.service


â¸»

âš ï¸ æ³¨æ„äº‹é¡¹
	1.	è‹¥ä½ ä½¿ç”¨äº† .env æ–‡ä»¶è¿›è¡Œé…ç½®ï¼ˆæ¨èï¼‰ï¼Œå¯ç”¨å¦‚ä¸‹æ›¿ä»£ ExecStartï¼š

ExecStart=/bin/bash -c 'source /home/lqh/Benony/venv/bin/activate && python app.py'


	2.	è‹¥é¡¹ç›®ç›‘å¬ 0.0.0.0:5000ï¼Œè®°å¾—é˜²ç«å¢™å¼€æ”¾ç«¯å£ï¼š

sudo ufw allow 5000

â¸»

ğŸ§© Bonusï¼šæµ‹è¯•æ˜¯å¦æˆåŠŸ

æ‰“å¼€æµè§ˆå™¨è®¿é—®æœåŠ¡å™¨ IPï¼ˆå…¬ç½‘æˆ–å†…ç½‘ï¼‰ï¼š

http://<ä½ çš„æœåŠ¡å™¨IP>:5000


é›†ä¸­æŸ¥çœ‹å¤šä¸ªæœåŠ¡çŠ¶æ€å¯ä»¥ç”¨é€šé…ç¬¦æ‰¹é‡æŸ¥ï¼š

systemctl list-units --type=service | grep lqh

æˆ–ï¼š

systemctl status neibr.service
journalctl -u neibr.service -n 50